
## - 如何保障消息队列高可用
### RabbitMQ
集群模式 + 镜像队列

### Kafka
分区数据开启多副本

## - 如何保障数据不重复？
### 生产者
确保生产者生产数据不重复

### 消费者
- 消息携带唯一id，进行幂等校验
- 若是kafka，offset手动提交

## - 如何保障数据不丢失？

### RabbitMQ
1. 生产者生产数据时异常导致丢失
```
- （不推荐）：使用事务，异常回滚，正常则提交
- （推荐）：使用ack（可以异常回调确认也可以同步确认）
```

2. 队列数据是在内存
```
开启队列数据落盘
```

3. 消费者消费数据未成功，但ack已确认
```
关闭自动ack，对数据进行手动ack
```

### Kafka
1. 生产者生产数据时异常导致丢失
```
开启ack=all确认消费同步至所有副本
```

2. 队列本身
```
- 分区设置多副本
- `min.insync.replicas`该参数可以设置数据最少同步的副本数
```

3. 消费者数据未消费，但offset已提交
```
关闭offset自动提交，手动提交offset
```

## - 如何保障数据顺序消费？
### RabbitMQ
1. 一个消费者不要用多线程处理数据
2. 同一队列确保只有一个消费者消费

### Kafka
1. 一个消费者不要用多线程处理数据
2. 同一业务数据生产时设置相同key，保障数据落到同一分区
3. 一个消费者只消费一个分区数据


